# =============================================================================
# Green 환경 Upstream 설정 (DNS 동적 resolve)
# =============================================================================
# 이 파일이 upstream.conf로 복사되면 Green 환경으로 트래픽이 라우팅됨
#
# map 블록으로 변수를 정의하여 proxy_pass에서 사용하면
# Nginx가 resolver 설정에 따라 주기적으로 DNS를 재resolve함
# (upstream 블록은 config 로드 시 한 번만 resolve하여 IP 변경 시 502 발생)
#
# 사용법:
#   cp upstream-green.conf conf.d/upstream.conf
#   docker compose exec nginx nginx -s reload
# =============================================================================

# Web Client (Next.js) - Green
map $host $web_client {
    default web-client-green:4000;
}

# Core API (Fastify) - Green
map $host $core_api {
    default core-api-green:3000;
}